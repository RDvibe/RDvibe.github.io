<!DOCTYPE html>
<html>
<head>
  <title>ArtIA Smart Land</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
    }
    #images {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
    }
    .image {
      margin: 10px;
      border: 2px solid #333;
    }
    .image img {
      width: 200px;
      height: auto;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
</head>
<body>
  <h1 style="text-align: center; padding: 20px; background: #333; color: #fff;">ArtIA Smart Land</h1>
  <button id="sign-in-button" onclick="signInWithGoogle()">Iniciar sesión con Google</button>
  <form id="upload-form" style="display: flex; justify-content: center; padding: 20px;">
    <input type="file" id="image-upload" accept="image/*">
    <textarea id="image-description" placeholder="Describe la visión" style="margin-left: 10px;"></textarea>
    <button type="submit" style="margin-left: 10px;">Subir</button>
  </form>
  <div id="images"></div>
  <script>
    var firebaseConfig = {
      // Tu configuración de Firebase
      apiKey: "AIzaSyBSgKSxonhLn1rO2CVwP0nBdcGKNFj1C_Y",
      authDomain: "diario-ad840.firebaseapp.com",
      databaseURL: "https://diario-ad840-default-rtdb.firebaseio.com",
      projectId: "diario-ad840",
      storageBucket: "diario-ad840.appspot.com",
      messagingSenderId: "38131773754",
      appId: "1:38131773754:web:bbe902bdbcce75a706e003"
    };

    firebase.initializeApp(firebaseConfig);

    var db = firebase.firestore();
    var form = document.getElementById('upload-form');
    var fileInput = document.getElementById('image-upload');
    var descInput = document.getElementById('image-description');
    var imagesDiv = document.getElementById('images');

    function signInWithGoogle() {
      var provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider).then(function(result) {
        var token = result.credential.accessToken;
        var user = result.user;
        console.log('Usuario ha iniciado sesión con Google:', user);
      }).catch(function(error) {
        console.error('Error durante inicio de sesión con Google:', error);
      });
    }

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // El usuario ha iniciado sesión.
        console.log('Usuario ha iniciado sesión:', user);
      } else {
        // El usuario no ha iniciado sesión.
        console.log('Usuario no ha iniciado sesión.');
      }
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (firebase.auth().currentUser) {
        uploadImage(fileInput.files[0], descInput.value);
        descInput.value = '';
      } else {
        console.log('Debe iniciar sesión para subir imágenes.');
      }
    });

    function uploadImage(file, description) {
      var storageRef = firebase.storage().ref();
      var uploadTask = storageRef.child('images/' + file.name).put(file);

      uploadTask.on('state_changed', function(snapshot) {
        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        console.log('Upload is ' + progress + '% done');
      }, function(error) {
        console.error('Upload failed:', error);
      }, function() {
        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
          db.collection("images").add({
            url: downloadURL,
            description: description,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          }).then(function(docRef) {
            console.log("Document written with ID: ", docRef.id);
          }).catch(function(error) {
            console.error("Error adding document: ", error);
          });
        });
      });
    }

    db.collection("images").orderBy('timestamp', 'desc').onSnapshot(function(snapshot) {
      snapshot.docChanges().forEach(function(change) {
        if (change.type === "added") {
          if (firebase.auth().currentUser) {
            displayImage(change.doc.data().url, change.doc.data().description);
          } else {
            console.log('Debe iniciar sesión para ver las imágenes.');
          }
        }
      });
    });

    function displayImage(url, description) {
      var div = document.createElement('div');
      div.classList.add('image');
      var img = document.createElement('img');
      img.src = url;
      var p = document.createElement('p');
      p.textContent = description;
      div.appendChild(img);
      div.appendChild(p);
      imagesDiv.prepend(div);
    }
  </script>
</body>
</html>


