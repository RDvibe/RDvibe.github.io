<head>
  <title>Galeria Colectiva</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
    }
    #images {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
    }
    .image {
      margin: 10px;
      border: 2px solid #333;
    }
    .image img {
      width: 200px;
      height: auto;
    }

    #sign-in-button {
      width: 300px;  /* Ancho del botón */
      height: 100px;  /* Altura del botón */
      font-size: 50px;  /* Tamaño de la fuente del botón */
    }

    #loading-icon {
      border: 16px solid #f3f3f3;
      border-top: 16px solid #3498db;
      border-radius: 50%;
      width: 120px;
      height: 120px;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
   <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
 

</head>
<body>

  <div id="loading-page" style="position: fixed; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100vw; height: 100vh; background: #fff; z-index: 100;">
    <div class="loading-icon"></div>
    <p class="loading-text" style="text-align: center; font-size: 2em;">Cargando página, por favor espera...</p>
  </div>

  <div id="user-details"></div>
  <button id="sign-in-button" style="display: none;">Iniciar sesión con Google</button>
  <button id="sign-out-button" style="display: none;">Cerrar sesión</button>

  <div id="loading-upload" style="position: fixed; display: none; flex-direction: column; justify-content: center; align-items: center; width: 100vw; height: 100vh; background: #fff; z-index: 100;">
    <div class="loading-icon"></div>
    <p class="loading-text" style="text-align: center;">Subiendo imagen, por favor espera...</p>
  </div>

  <h1 style="text-align: center; padding: 20px; background: #333; color: #fff;">Galeria colectiva By RD art</h1>

  <div style="text-align: center; padding: 20px; font-family: 'Georgia', serif;">
  <h2>Estás aquí, en el amanecer de un nuevo proyecto...</h2>
  <p>
    Este es un universo en expansión, un proyecto naciente que fusiona el arte impulsado por la Inteligencia Artificial y el encanto inmutable de la Blockchain.
    Por ahora, este espacio sirve como una galería, un lugar para exhibir creaciones únicas y maravillosas.
  </p>
  <p>
    Pero aguarda, querido visitante. Pronto, este lugar se convertirá en mucho más que una simple galería.
    Nuestra visión está desplegándose, transformándose en algo más grande, más emocionante, más... innovador.
    Así que mantente alerta.
  </p>
  <p>
    Te invitamos a sumarte a este viaje. Sube tu imagen (preferiblemente de 1024 x 1024) y añade tu descripción. 
    Y si te apetece, charla con nuestro bot. Pronto, habrá aún más sorpresas que descubrir.
  </p>
  <p>
    Gracias por estar aquí, en los albores de este proyecto.
  </p>
</div>

  
  <!-- Añadimos el botón después del h1 -->
  <div style="text-align: center; padding: 20px;">
    <a href="https://rdapp-psychovibe.streamlit.app/" target="_blank">
      <button style="padding: 10px 20px; font-size: 1.2em;">Chatea con nuestro bot</button>
    </a>
  </div>

  <form id="upload-form" style="display: flex; justify-content: center; padding: 20px;">
    <input type="file" id="image-upload" accept="image/*">
    <textarea id="image-description" placeholder="Describe la visión" style="margin-left: 10px;"></textarea>
    <button type="submit" style="margin-left: 10px;">Subir</button>
  </form>
  <div id="images"></div>
 
  <script>
    var firebaseConfig = {
      // Tu configuración de Firebase
      apiKey: "AIzaSyBSgKSxonhLn1rO2CVwP0nBdcGKNFj1C_Y",
      authDomain: "diario-ad840.firebaseapp.com",
      databaseURL: "https://diario-ad840-default-rtdb.firebaseio.com",
      projectId: "diario-ad840",
      storageBucket: "diario-ad840.appspot.com",
      messagingSenderId: "38131773754",
      appId: "1:38131773754:web:bbe902bdbcce75a706e003"
    };

   firebase.initializeApp(firebaseConfig);
var provider = new firebase.auth.GoogleAuthProvider();

document.getElementById('sign-in-button').addEventListener('click', function() {
  firebase.auth().signInWithRedirect(provider);
});

firebase.auth().getRedirectResult().then(function(result) {
  if (result.credential) {
    // This gives you a Google Access Token. You can use it to access the Google API.
    var token = result.credential.accessToken;
    // The signed-in user info.
    var user = result.user;
  }
}).catch(function(error) {
  // Handle Errors here.
  var errorCode = error.code;
  var errorMessage = error.message;
  // The email of the user's account used.
  var email = error.email;
  // The firebase.auth.AuthCredential type that was used.
  var credential = error.credential;
});

document.getElementById('sign-out-button').addEventListener('click', function() {
  firebase.auth().signOut();
});

firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in.
    document.getElementById('user-details').textContent = 'Hola ' + user.displayName;
    document.getElementById('sign-in-button').style.display = 'none';
    document.getElementById('sign-out-button').style.display = 'block';
    document.getElementById('upload-form').style.display = 'flex';
  } else {
    // No user is signed in.
    document.getElementById('user-details').textContent = '';
    document.getElementById('sign-in-button').style.display = 'block';
    document.getElementById('sign-out-button').style.display = 'none';
    document.getElementById('upload-form').style.display = 'none';
  }
});

var db = firebase.firestore();
var form = document.getElementById('upload-form');
var fileInput = document.getElementById('image-upload');
var descInput = document.getElementById('image-description');
var imagesDiv = document.getElementById('images');

form.addEventListener('submit', function(e) {
  e.preventDefault();
  uploadImage(fileInput.files[0], descInput.value);
  descInput.value = '';
});


    function uploadImage(file, description) {
      // Muestra el mensaje de carga de subida
      document.getElementById('loading-upload').style.display = 'flex';

      var storageRef = firebase.storage().ref();
      var uploadTask = storageRef.child('images/' + file.name).put(file);

      uploadTask.on('state_changed', function(snapshot) {
        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        console.log('Upload is ' + progress + '% done');
      }, function(error) {
        // Oculta el mensaje de carga en caso de error
        document.getElementById('loading-upload').style.display = 'none';
        console.error('Upload failed:', error);
      }, function() {
        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
          return db.collection("images").add({
            url: downloadURL,
            description: description
          });
        }).then(function(docRef) {
          console.log("Document written with ID: ", docRef.id);
          displayImage(docRef.data().url, docRef.data().description);
        }).catch(function(error) {
          console.error("Error adding document: ", error);
        }).finally(function() {
          // Oculta el mensaje de carga una vez que la imagen ha sido subida y agregada a la base de datos
          document.getElementById('loading-upload').style.display = 'none';
        });
      });
    }

    function displayImage(url, description) {
      var div = document.createElement('div');
      div.className = 'image';
      var a = document.createElement('a');
      a.href = url;
      a.target = '_blank';
      var img = document.createElement('img');
      img.src = url;
      a.appendChild(img);
      div.appendChild(a);
      var p = document.createElement('p');
      p.textContent = description;
      div.appendChild(p);
      imagesDiv.appendChild(div);
    }

    // Display images from Firestore on page load
db.collection("images").get().then(function(querySnapshot) {
  querySnapshot.forEach(function(doc) {
    console.log(doc.id, " => ", doc.data());
    displayImage(doc.data().url, doc.data().description);
  });

  // Agrega un retraso antes de ocultar el mensaje de carga de la página
  setTimeout(function() {
    document.getElementById('loading-page').style.display = 'none';
  }, 3000);  // Delay in milliseconds

}).catch(function(error) {
  console.error("Error getting documents: ", error);
  // Si hay un error, también ocultamos 'loading-page'
  document.getElementById('loading-page').style.display = 'none';
});

  </script>
</body>
</html>
